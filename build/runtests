#!/bin/csh -f

# Create the Javadoc and XML for two Java APIs, and then compare them.

cd ../test

# Make sure we can find xerces.jar
setenv CLASSPATH ../lib/xerces.jar:$CLASSPATH

echo These are the packages in each version of the API
setenv OLDPKGS 'RemovedPackage ChangedPackage ChangedPackageDoc ChangedPackageDoc2'
setenv NEWPKGS 'AddedPackage ChangedPackage ChangedPackageDoc ChangedPackageDoc2'

# Generate Javadoc for the old API
mkdir olddocs
cd olddocs
javadoc -private -sourcepath ../old -doctitle "JDiff Test Old API" -windowtitle "JDiff Test Old API" $OLDPKGS
cd ..

# Generate Javadoc for the new API
mkdir newdocs
cd newdocs
javadoc -private -sourcepath ../new -doctitle "JDiff Test New API" -windowtitle "JDiff Test New API" $NEWPKGS
cd ..

# Generate XML for the old API.
javadoc -private -excludeclass private -excludemember private -J-Xmx128m -doclet jdiff.JDiff -docletpath ../lib/jdiff.jar:../lib/xerces.jar -apiname "Old Test API" -sourcepath old $OLDPKGS

# Generate XML for the new API
javadoc -private -excludeclass private -excludemember private -J-Xmx128m -doclet jdiff.JDiff -docletpath ../lib/jdiff.jar:../lib/xerces.jar -apiname "New Test API" -baseURI "file:///$HOME/jdiff/lib" -sourcepath new $NEWPKGS

# Generate HTML report comparing the old and new APIs
javadoc -J-Xmx128m -doclet jdiff.JDiff -docletpath ../lib/jdiff.jar:../lib/xerces.jar -d newdocs -oldapi "Old Test API" -newapi "New Test API" -javadocold "../../olddocs/" -javadocnew "../../newdocs/" ../lib/Null.java
cp ../lib/background.gif newdocs

# Generate another HTML report comparing the old and new APIs, but including 
# changes in documentation by using -docchanges and statistics using -stats
mkdir newdocs2
javadoc -J-Xmx128m -doclet jdiff.JDiff -docletpath ../lib/jdiff.jar:../lib/xerces.jar -d newdocs2 -docchanges -stats -oldapi "Old Test API" -newapi "New Test API" -javadocold "../../olddocs/" -javadocnew "../../newdocs/" ../lib/Null.java
cp ../lib/background.gif newdocs2
cp ../lib/black.gif newdocs2/black.gif

cd ../build

echo "Now open the file ../test/newdocs/changes.html in a browser"
echo "and also open the file ../test/newdocs2/changes.html in a browser"
