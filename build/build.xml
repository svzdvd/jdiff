<!-- An ANT build file for JDiff -->

<project name="jdiff" default="jdiff" basedir=".">

<target name="usage">
  <echo message="usage: ant jdiff"/>
</target>
 
<!-- ======================================================= -->
<!-- Properties used when generating Javadoc and JDiff output. -->
<!-- ======================================================= -->
<target name="init">
  <property name="app.name" value="JDiff"/>
  <!-- Root of the JDiff hierarchy of directories -->
  <property name="JDIFF_HOME" value=".."/>

  <!-- Source .java files for JDiff -->
  <property name="SRC" value="${JDIFF_HOME}/src"/>
  <property name="DST" value="${SRC}"/>

  <path id="class.path">
    <pathelement location="${JDIFF_HOME}/lib/xerces.jar"/>
  </path>
  
  <property name="debug" value="true"/>
  <!-- Also works with javac1.4 -->
  <property name="build.compiler"  value="javac1.3"/>    
</target>

<!-- ======================================================= -->
<!-- Run all the steps used to build JDiff -->
<!-- ======================================================= -->
<target name="jdiff" depends="compile_jdiff,jar_jdiff,compile_ant_task,jar_ant_task"/>
  
<!-- ======================================================= -->
<!-- Clean up various files and directories                  -->
<!-- ======================================================= -->
<target	name="clean" depends="init">
  <delete
    includeEmptyDirs="true"
    verbose="true">
    <fileset dir="${SRC}" includes="**/*.class,**/*~"/>
  </delete>
</target>
 	
<!-- ======================================================= -->
<!-- Compile all JDiff source files, but not the Ant task    -->
<!-- ======================================================= -->
<target name="compile_jdiff" depends="init">
<javac	
  srcdir="${SRC}"
  destdir="${DST}"
  debug="${debug}"
  excludes="jdiff/JDiffAntTask.java"
  includeJavaRuntime="yes">
  <classpath>
    <path refid="class.path"/>
  </classpath>
</javac>
</target>	
	
<!-- ======================================================= -->
<!-- Create JDiff.jar, but exclude the Ant task file         -->
<!-- ======================================================= -->
<target name="jar_jdiff" depends="compile_jdiff">
<jar 
  jarfile="${JDIFF_HOME}/lib/jdiff.jar" 
  basedir="${DST}"
  includes="*jdiff/*.class"
  excludes="*jdiff/JDiffAntTask*.class"/>
</target>	
	
<!-- ======================================================= -->
<!-- Compile the JDiff Ant task                              -->
<!-- ======================================================= -->
<target name="compile_ant_task" depends="init">
<javac	
  srcdir="${SRC}"
  destdir="${DST}"
  includes="jdiff/JDiffAntTask.java"
  debug="${debug}"
  includeJavaRuntime="yes">
  <classpath>
    <path refid="class.path"/>
  </classpath>
</javac>
</target>	
	
<!-- ======================================================= -->
<!-- Create the jar for the JDiff Ant task                   -->
<!-- ======================================================= -->
<target name="jar_ant_task" depends="compile_ant_task">
<jar 
  jarfile="${JDIFF_HOME}/lib/antjdiff.jar" 
  basedir="${DST}"
  includes="*jdiff/JDiffAntTask*.class"/>
</target>	
	
</project>
